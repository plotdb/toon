var encoder,ref$,decoder,encode,decode;function import$(e,t){var r,n={}.hasOwnProperty;for(r in t)n.call(t,r)&&(e[r]=t[r]);return e}function repeatString$(e,t){for(var r="";0<t;(t>>=1)&&(e+=e))1&t&&(r+=e);return r}(encoder=function(e){return null==e&&(e={}),this.indent=2,this.delimiter=",",this.lengthMarker=!1,import$(this,e),this}).prototype=((ref$=Object.create(Object.prototype)).constructor=encoder,ref$.encode=function(e){switch(!1){case null!==e:case void 0!==e:return"null";case!("object"==typeof e&&null!==e&&!Array.isArray(e)):return 0===Object.keys(e).length?"":this.encodeObject(e,0);case!Array.isArray(e):return this.encodeArray(e,0,null).join("\n");default:return this.encodePrimitive(e)}},ref$.encodeObject=function(e,t){var r,n,i,s=[];repeatString$(" ",t*this.indent);for(r in e)i=e[r],n=this.formatKey(r),i=this.encodeValue(i,t,n),s=s.concat(i);return s.join("\n")},ref$.encodeValue=function(e,t,r){var n=repeatString$(" ",t*this.indent);return null==e?[n+""+r+": null"]:"boolean"==typeof e?[n+""+r+": "+e]:"number"==typeof e?[n+""+r+": "+this.normalizeNumber(e)]:"bigint"==typeof e?[n+""+r+": "+String(e)]:e instanceof Date?[n+""+r+": "+this.quoteString(e.toISOString())]:"string"==typeof e?[n+""+r+": "+this.encodeString(e)]:"function"==typeof e||"symbol"==typeof e?[n+""+r+": null"]:"object"!=typeof e||null===e||Array.isArray(e)?Array.isArray(e)?this.encodeArray(e,t,r):[n+""+r+": null"]:(n=n+""+r+":",0===Object.keys(e).length?[n]:(r=this.encodeObject(e,t+1),[n].concat(r.split("\n"))))},ref$.encodeArray=function(e,t,r){var n=this,i=e.length,i=this.lengthMarker?"#"+i:i,s=repeatString$(" ",t*this.indent),u=this.delimiter,a=","===u?"":u;return this.isTabular(e)?this.formatTabular(e,t,r,i):e.every(function(e){return n.isPrimitive(e)})?(u=(u=e.map(function(e){return n.encodePrimitive(e)}).join(u))?": "+u:":",null!=r?[s+""+r+"["+i+a+"]"+u]:["["+i+a+"]"+u]):this.formatList(e,t,r,i)},ref$.isTabular=function(e){var r,t=this;return 0!==e.length&&!!e.every(function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)})&&0!==(r=Object.keys(e[0]).sort()).length&&!!e.every(function(e){e=Object.keys(e).sort();return e.length===r.length&&e.every(function(e,t){return e===r[t]})})&&e.every(function(e){return Object.values(e).every(function(e){return t.isPrimitive(e)})})},ref$.isPrimitive=function(e){var t;return null==e||"string"==(t=typeof e)||"number"==t||"boolean"==t||"bigint"==t||e instanceof Date},ref$.formatTabular=function(e,t,r,n){var i=this,s=repeatString$(" ",t*this.indent),u=repeatString$(" ",(t+1)*this.indent),a=this.delimiter,t=","===a?"":a,o=Object.keys(e[0]),l=o.map(function(e){return i.formatKey(e)}).join(a),s=null!=r?s+""+r+"["+n+t+"]{"+l+"}:":"["+n+t+"]{"+l+"}:",r=e.map(function(t){var e=o.map(function(e){return i.encodePrimitive(t[e])});return u+""+e.join(a)});return[s].concat(r)},ref$.formatList=function(e,t,r,n){for(var i,s,u,a,o,l,c,f,h,d=this,p=repeatString$(" ",t*this.indent),g=repeatString$(" ",(t+1)*this.indent),y=this.delimiter,m=","===y?"":y,v=[null!=r?p+""+r+"["+n+m+"]:":"["+n+m+"]:"],$=0,b=e.length;$<b;++$)if("object"!=typeof(i=e[$])||null===i||Array.isArray(i))Array.isArray(i)?(c=i.length,c=this.lengthMarker?"#"+c:c,f=","===y?"":y,h=i.map(x).join(y),v.push(g+"- ["+c+f+"]: "+h)):v.push(g+"- "+this.encodePrimitive(i));else if(0<(s=Object.keys(i)).length)for(c=s[0],f=this.formatKey(c),h=this.encodeValue(i[c],t+1,f)[0].replace(/^\s+/,g+"- "),v.push(h),u=1,a=s.length;u<a;++u)l=s[u],o=this.formatKey(l),l=this.encodeValue(i[l],t+1,o),v=v.concat(l);else v.push(g+"-");return v;function x(e){return d.encodePrimitive(e)}},ref$.encodePrimitive=function(e){switch(!1){case null!==e:case void 0!==e:return"null";case"boolean"!=typeof e:return String(e);case"number"!=typeof e:return this.normalizeNumber(e);case"bigint"!=typeof e:return String(e);case!(e instanceof Date):return this.quoteString(e.toISOString());case"string"!=typeof e:return this.encodeString(e);default:return"null"}},ref$.normalizeNumber=function(e){var t;return isFinite(e)?0===e||-0===e?"0":(t=String(e),/e/i.test(t)?(t=0<e&&e<1?e.toFixed(20):1e15<Math.abs(e)?e.toFixed(0):e.toFixed(10)).replace(/\.?0+$/,""):t):"null"},ref$.encodeString=function(e){return this.shouldQuote(e)?this.quoteString(e):e},ref$.shouldQuote=function(e){return""===e||" "===e[0]||" "===e[e.length-1]||0<=e.indexOf(this.delimiter)||0<=e.indexOf(":")||0<=e.indexOf('"')||0<=e.indexOf("\\")||!!/[\x00-\x1F]/.test(e)||"true"===e||"false"===e||"null"===e||!!(/^-?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(e)||e.startsWith("- ")||/^\[.*\]$/.test(e)||/^\{.*\}$/.test(e))},ref$.quoteString=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")+'"'},ref$.formatKey=function(e){return/^[a-zA-Z_][a-zA-Z0-9_\.]*$/.test(e)?e:this.quoteString(e)},ref$),(decoder=function(e){return null==e&&(e={}),this.strict=!1,import$(this,e),this}).prototype=((ref$=Object.create(Object.prototype)).constructor=decoder,ref$.decode=function(e){var t;return""===e||0===(e=e.split("\n")).length?{}:(t=e[0].trim()).startsWith("[")?this.parseArray(e,0,0).value:0<=t.indexOf(":")?this.parseObject(e,0,0).value:this.parseValue(t)},ref$.parseObject=function(e,t,r){for(var n,i,s,u,a,o,l,c,f,h={},d=2*r,p=t;p<e.length&&!((i=this.getIndent(n=e[p]))<d);)!(d<i)&&(l=n.trim())?/^[^:]+\[.*\](\{[^}]+\})?:/.test(l)?(a=l.indexOf("["),s=l.substring(0,a),o=(a=l.substring(a)).indexOf(":"),a.substring(o+1).trim()&&!/^\[.*\]\{/.test(a)?(u=this.parseArray([a],0,r),h[s]=u.value,p++):(o=[a].concat(e.slice(p+1)),u=this.parseArray(o,0,r),h[s]=u.value,p+=u.nextIdx)):0<=this.findColon(l)?(s=(a=this.parseKeyValue(l)).key,o=a.value,a.isNested?(l=p+1)<e.length&&(f=e[l],c=this.getIndent(f),f=f.trim(),i<c)?p=(u=f.startsWith("- ")?this.parseList(e,l,r+1):/^\[.*\]\{/.test(f)||/^\[.*\]:/.test(f)?this.parseArray(e,l,r+1):this.parseObject(e,l,r+1),h[s]=u.value,u.nextIdx):(h[s]={},p++):(h[s]=this.parseValue(o),p++)):p++:p++;return{value:h,nextIdx:p}},ref$.parseArray=function(e,t,r){var n,i;return t>=e.length?{value:[],nextIdx:t+1}:(i=e[t].trim(),/^\[.*\]\{/.test(i)?this.parseTabular(e,t,r):/^\[.*\]:/.test(i)?(n=i.indexOf(":"),!i.substring(n+1).trim()&&(i=t+1)<e.length&&e[i].trim().startsWith("- ")?this.parseList(e,t,r):this.parseInline(e,t,r)):{value:[],nextIdx:t+1})},ref$.parseInline=function(e,t,r){var n,i=this,e=e[t].trim().match(/^\[#?(\d+)(.?)\]:\s*(.*)$/);return e&&(parseInt(e[1],10),n=e[2]||",",e=e[3])?{value:this.splitValues(e,n).map(function(e){return i.parseValue(e)}),nextIdx:t+1}:{value:[],nextIdx:t+1}},ref$.parseTabular=function(e,t,r){var n,i,s,u,a,o,l,c,f,h,d,p,g,y,m=this,v=e[t].trim().match(/^\[#?(\d+)(.?)\]\{([^}]+)\}:$/);if(!v)return{value:[],nextIdx:t+1};for(n=parseInt(v[1],10),i=v[2]||",",v=v[3],s=(s=this.splitValues(v,i)).map(function(e){return'"'===(e=e.trim())[0]&&'"'===e[e.length-1]?m.unquote(e):e}),u=[],a=2*(r+1),o=t+1,l=0;l<n&&!(o>=e.length)&&!(this.getIndent(c=e[o])<a);++l){for(f=c.trim(),h=this.splitValues(f,i),d={},p=0,g=s.length;p<g;++p)d[s[y=p]]=this.parseValue(h[y]||"null");u.push(d),o++}return{value:u,nextIdx:o}},ref$.parseList=function(e,t,r){var n,i,s,u,a,o,l,c,f,h,d=this,p=e[t].trim(),g=t;for(/^\[.*\]:$/.test(p)&&g++,n=[],i=2*(r+1);g<e.length&&!(this.getIndent(s=e[g])<i);)if((u=s.trim()).startsWith("- "))if(0<=(u=u.substring(2)).indexOf(":")){for((a={})[(c=this.parseKeyValue(u)).key]=this.parseValue(c.value),g++;g<e.length&&!(this.getIndent(l=e[g])<=i)&&!(o=l.trim()).startsWith("- ");)0<=o.indexOf(":")&&(a[(l=this.parseKeyValue(o)).key]=this.parseValue(l.value)),g++;n.push(a)}else u.startsWith("[")?(c=u.match(/^\[#?(\d+)(.?)\]:\s*(.*)$/))&&(f=c[2]||",",h=c[3],h=this.splitValues(h,f).map(y),n.push(h)):n.push(this.parseValue(u)),g++;else g++;return{value:n,nextIdx:g};function y(e){return d.parseValue(e)}},ref$.getIndent=function(e){for(var t=0,r=0,n=e.length;r<n&&" "===e[r];++r)t++;return t},ref$.findColon=function(e){for(var t,r=!1,n=0;n<e.length;){if('"'!==(t=e[n])||0!==n&&"\\"===e[n-1]){if(":"===t&&!r)return n}else r=!r;n++}return-1},ref$.parseKeyValue=function(e){var t,r=this.findColon(e);return r<0?{key:e,value:"",isNested:!1}:(t=e.substring(0,r).trim(),e=e.substring(r+1).trim(),{key:'"'===t[0]&&'"'===t[t.length-1]?this.unquote(t):t,value:e,isNested:""===e})},ref$.parseValue=function(e){return"null"===(e=e.trim())?null:"true"===e||"false"!==e&&(/^-?\d+(\.\d+)?$/.test(e)?parseFloat(e):'"'===e[0]&&'"'===e[e.length-1]?this.unquote(e):e)},ref$.unquote=function(e){return e.substring(1,e.length-1).replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\"/g,'"').replace(/\\\\/g,"\\")},ref$.splitValues=function(e,t){for(var r,n=[],i="",s=!1,u=0;u<e.length;)'"'===(r=e[u])?(0<u&&"\\"===e[u-1]&&(u<2||"\\"!==e[u-2])||(s=!s),i+=r):r!==t||s?i+=r:(n.push(i.trim()),i=""),u++;return!i&&0!==n.length||n.push(i.trim()),n},ref$),encode=function(e,t){return new encoder(t).encode(e)},decode=function(e,t){return new decoder(t).decode(e)},"undefined"!=typeof window&&null!==window?(window.encoder=encoder,window.decoder=decoder,window.encode=encode,window.decode=decode):module.exports={encoder:encoder,decoder:decoder,encode:encode,decode:decode};
